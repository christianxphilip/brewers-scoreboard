# Deploying to Render.com

This guide walks you through deploying the Scoreboard Management System to Render.

## Prerequisites

- A [Render account](https://render.com) (free tier available)
- Git repository with your code pushed to GitHub/GitLab/Bitbucket

## Option 1: Deploy with Blueprint (Recommended)

The easiest way to deploy is using the `render.yaml` blueprint file.

1. **Push your code to a Git repository**

2. **Create a new Blueprint on Render**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New" → "Blueprint"
   - Connect your Git repository
   - Render will automatically detect `render.yaml` and create all services

3. **Configure Environment Variables**
   
   The blueprint will auto-generate most variables, but you should update:
   - `JWT_SECRET`: Set a strong secret key (auto-generated by default)
   - Review CORS settings if needed

4. **Deploy**
   - Click "Apply" to create all services
   - Wait for deployment to complete (~5-10 minutes)

## Option 2: Manual Deployment

### Step 1: Create PostgreSQL Database

1. Go to Render Dashboard → "New" → "PostgreSQL"
2. Configure:
   - **Name**: `scoreboard-db`
   - **Database**: `scoreboard`
   - **User**: `scoreboard_user`
   - **Region**: Choose closest to your users
   - **Plan**: Free
3. Click "Create Database"
4. Copy the **Internal Database URL** (starts with `postgres://`)

### Step 2: Deploy Backend

1. Go to Render Dashboard → "New" → "Web Service"
2. Connect your Git repository
3. Configure:
   - **Name**: `scoreboard-backend`
   - **Region**: Same as database
   - **Branch**: `main`
   - **Root Directory**: `backend`
   - **Environment**: `Node`
   - **Build Command**: `npm install && npm run migrate`
   - **Start Command**: `npm start`
   - **Plan**: Free

4. Add Environment Variables:
   ```
   NODE_ENV=production
   PORT=10000
   DATABASE_URL=<paste Internal Database URL from Step 1>
   JWT_SECRET=<generate a strong random string>
   JWT_EXPIRES_IN=7d
   CORS_ORIGIN=<will add after frontend deployment>
   ```

5. Click "Create Web Service"
6. Wait for deployment and note the backend URL (e.g., `https://scoreboard-backend.onrender.com`)

### Step 3: Deploy Frontend

1. Go to Render Dashboard → "New" → "Static Site"
2. Connect your Git repository
3. Configure:
   - **Name**: `scoreboard-frontend`
   - **Branch**: `main`
   - **Root Directory**: `frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `dist`

4. Add Environment Variable:
   ```
   VITE_API_URL=<paste backend URL from Step 2>
   ```

5. Add Rewrite Rule:
   - **Source**: `/*`
   - **Destination**: `/index.html`
   - **Action**: `Rewrite`

6. Click "Create Static Site"
7. Note the frontend URL (e.g., `https://scoreboard-frontend.onrender.com`)

### Step 4: Update CORS

1. Go back to your backend service settings
2. Update the `CORS_ORIGIN` environment variable with your frontend URL
3. Save and redeploy

## Post-Deployment

### Create Admin User

1. Use the API to register an admin user:
   ```bash
   curl -X POST https://your-backend.onrender.com/api/auth/register \
     -H "Content-Type: application/json" \
     -d '{
       "email": "admin@yourdomain.com",
       "password": "your-secure-password",
       "name": "Admin User",
       "role": "admin"
     }'
   ```

2. Save the returned JWT token

### Seed Sample Data (Optional)

SSH into your backend service and run:
```bash
npm run seed
```

Or use the Render Shell from the dashboard.

## Verify Deployment

1. **Backend Health Check**:
   ```
   https://your-backend.onrender.com/health
   ```
   Should return: `{"status":"ok","timestamp":"..."}`

2. **Frontend**: Visit your frontend URL and test login

3. **Public Scoreboard**: After creating a scoreboard, test:
   ```
   https://your-backend.onrender.com/api/public/scoreboard/your-slug
   ```

## Troubleshooting

### Database Connection Issues

- Verify `DATABASE_URL` is set correctly
- Check database is in the same region as backend
- Review backend logs for connection errors

### CORS Errors

- Ensure `CORS_ORIGIN` matches your frontend URL exactly
- Include protocol (`https://`)
- No trailing slash

### Build Failures

- Check build logs in Render dashboard
- Verify all dependencies are in `package.json`
- Ensure Node version compatibility

### Free Tier Limitations

- Services spin down after 15 minutes of inactivity
- First request after spin-down may take 30-60 seconds
- Database limited to 256MB on free tier

## Monitoring

- **Logs**: Available in Render dashboard for each service
- **Metrics**: View CPU, memory, and request metrics
- **Alerts**: Set up email notifications for deployment failures

## Custom Domain (Optional)

1. Go to your frontend service settings
2. Click "Custom Domains"
3. Add your domain and follow DNS configuration instructions

## Updating

Render auto-deploys on git push to your main branch. To deploy manually:

1. Go to service in Render dashboard
2. Click "Manual Deploy" → "Deploy latest commit"

## Environment Variables Reference

### Backend
- `NODE_ENV`: `production`
- `PORT`: `10000` (Render default)
- `DATABASE_URL`: Auto-set by Render
- `JWT_SECRET`: Strong random string
- `JWT_EXPIRES_IN`: Token expiry (e.g., `7d`)
- `CORS_ORIGIN`: Frontend URL

### Frontend
- `VITE_API_URL`: Backend URL

## Support

For Render-specific issues, check:
- [Render Documentation](https://render.com/docs)
- [Render Community](https://community.render.com)
